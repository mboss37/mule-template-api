<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:error-handler-plugin="http://www.mulesoft.org/schema/mule/error-handler-plugin" xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger"
	xmlns:validation="http://www.mulesoft.org/schema/mule/validation"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd
http://www.mulesoft.org/schema/mule/error-handler-plugin http://www.mulesoft.org/schema/mule/error-handler-plugin/current/mule-error-handler-plugin.xsd">
	<sub-flow name="assigning-correlation-id" doc:id="d3b9f8c9-d5f2-4dd5-ac08-6004902f7b3a" >
		<try doc:name="Try" doc:id="621e5adc-d274-4375-8180-35020a988843">
				<choice doc:name="Choice" doc:id="2c0d7334-cb0e-4312-8133-9c9c28aa5335">
					<when expression="#[p('correlation.impose') == &quot;true&quot;]">
						<validation:is-not-null doc:name="Is not null" doc:id="f0c7b3e7-3df1-4d70-990f-2d8d8d7156b7" value='#[attributes.headers."x-correlation-id"]' />
						<set-variable value='#[attributes.headers."x-correlation-id"]' doc:name="set correlationId variable" doc:id="8894b50f-9e63-4e69-ac51-66d4acd642c1" variableName="correlationId" />
					</when>
					<otherwise>
						<set-variable value='#[if (attributes.headers."x-correlation-id" != null) 
												attributes.headers."x-correlation-id"
												else correlationId]' 
							doc:name="correlationId" 
							doc:id="47c25d1a-5f2e-4dd8-821c-d238214ff2cb" 
							variableName="correlationId" 
							doc:description="Message.correlationId will be automatically populated by the HTTP Listener when no X-Correlation-ID header value given. In this setter, we will take the value from the X-Correlation-ID header if value present, otherwise get it from the message.correlationId that is autogenerated." />
					</otherwise>
				</choice>
				<error-handler>
					<on-error-propagate enableNotifications="true" logException="true" doc:name="handle all errors" doc:id="1860ed69-fc88-46c9-87e7-8ef5907feb75" type="ANY">
						<raise-error doc:name="Raise error" doc:id="cb0738d6-8047-4c9d-8cb1-ae19fc7b0e5f" type="TECHNICAL:CORRELATION_ID_REQUIRED"/>
					</on-error-propagate>
				</error-handler>
			</try>
	</sub-flow>
	<error-handler name="common-api-errorHandler" doc:id="3b3a31e7-d753-4c1c-8270-d2ce4ca364f4" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="e163426c-a59e-4fff-8569-597816abb08d" type="ANY">
			<error-handler-plugin:on-error doc:name="Process Error" doc:id="000b8678-d127-4ad7-9386-9f722f6612c5" config-ref="Error_Handler_Plugin_Config"/>
			<set-variable 
				value="#[attributes.httpStatus]"
				doc:name="Set Variable" 
				doc:id="b6f7a213-706a-4872-8e3d-baa7fe80084f"
				variableName="httpStatus" />
		</on-error-propagate>
	</error-handler>
	
</mule>
